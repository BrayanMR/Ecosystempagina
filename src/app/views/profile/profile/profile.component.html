<!-- navbar -->
<app-navbar></app-navbar>
<!-- fin de navbar -->

<main class="bg-gray-100 bg-opacity-25">
  <div class="lg:w-8/12 lg:mx-auto mb-8">
    <header class="flex flex-wrap items-center p-4 md:py-8">
      <div class="md:w-3/12 md:ml-16">
        <!-- profile image -->
        <img
          *ngIf="photoUrl"
          [src]="photoUrl"
          alt="Imagen"
          class="w-20 h-20 md:w-40 md:h-40 object-cover rounded-full border-2 border-green-600 p-1"
        />
      </div>
      <!-- profile meta -->
      <div class="w-8/12 md:w-7/12 ml-4" *ngIf="usuarioActual?.uid">
        <h1 class="font-semibold text-green-600">{{usuarioActual.role}}</h1>
        <div class="md:flex md:flex-wrap md:items-center mb-4">
          <h2 class="text-3xl inline-block font-light md:mr-2 mb-2 sm:mb-0">
            {{ (usuarioActual?.name + ' ' + usuarioActual?.lastname).toUpperCase() }}
          </h2>
          <!-- badge -->
          <span
            class="inline-block fas fa-certificate fa-lg text-blue-500 relative mr-6 text-xl transform -translate-y-2"
            aria-hidden="true"
          >
            <i class="fas fa-check text-white text-xs absolute inset-x-0 ml-1 mt-px"></i>
          </span>
        </div>
        <!-- post y amigos -->
        <ul class="hidden md:flex space-x-8 mb-4">
          <li>
            <span class="font-semibold text-green-600">{{ posts.length }}</span>
            posts
          </li>
          <li>
            <span class="font-semibold text-green-600">{{ friends.length }}</span>
            amigos
          </li>
          <!-- Aquí incluimos el componente del modal -->
          <li>
            <span class="font-semibold text-green-600"></span>
            <button (click)="openEditModal()">Editar Datos</button>
          </li>
        </ul>
        <!-- post y amigos -->
        <ul class="hidden md:flex space-x-8 mb-4">
          <li>
            Curso
            <span class="font-semibold">{{ usuarioActual.curso }}</span>
          </li>
          <li>
            Institucion
            <span class="font-semibold">{{ usuarioActual.institucion }}</span>
          </li>
        </ul>
        <!-- user meta for medium screens -->
        <div class="hidden md:block">
          <h1 class="font-semibold"> DESCRIPCION</h1>
          <h1 class="font-semibold"></h1>
          <span></span>
          <p></p>
        </div>
      </div>
    </header>
<!-- Edit Modal -->
<div id="editModal" *ngIf="showEditModal" class="fixed z-10 inset-0 overflow-y-auto">
  <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
      <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-lg sm:w-full">
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div class="w-full text-center">
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
              Editar Perfil
            </h3>
             <!-- Imagen de perfil con actualización -->
             <div class="relative flex  mb-4  ">
              <label for="fileInput" class="cursor-pointer">
                <img [src]="selectedImageUrl || photoUrl || 'URL_DE_TU_IMAGEN'" alt="Foto de Perfil"
                  class="h-22 w-22 rounded-full border-4 border-green-500 cursor-pointer">
                <input type="file" id="fileInput" (change)="onFileSelected($event)" class="hidden">
              </label>
            </div>
          </div>
            <div class="mt-2">
              <form (ngSubmit)="saveEdit()" #usuarioForm="ngForm">
                <div class="mt-2">
                  <label for="name" class="block text-sm  text-gray-700 justify-start" >Nombre</label>
                  <input type="text" id="name" name="name" [(ngModel)]="usuarioActual.name" required
                    class="mt-1 p-2 w-full border rounded-md">
                </div>
                <div class="mt-2">
                  <label for="lastname" class="block text-sm  text-gray-700 justify-start">Apellido</label>
                  <input type="text" id="lastname" name="lastname" [(ngModel)]="usuarioActual.lastname" required
                    class="mt-1 p-2 w-full border rounded-md">
                </div>
                <div class="mt-2">
                  <label for="id" class="block text-sm text-gray-700 justify-start">ID</label>
                  <input type="text" id="id" name="id" [(ngModel)]="usuarioActual.identificacion" required
                    class="mt-1 p-2 w-full border rounded-md">
                </div>
                <div class="mt-4">
                  <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md">Guardar Cambios</button>
                  <button type="button" (click)="closeEditModal()"
                    class="ml-2 px-4 py-2 bg-gray-600 text-white rounded-md">Cancelar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <button type="button" (click)="closeEditModal()"
          class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
    <!-- posts -->
    <div class="px-px md:px-3">
      <!-- user following for mobile only -->
      <ul
        class="flex md:hidden justify-around space-x-8 border-t text-center p-2 text-gray-600 leading-snug text-sm"
      >
        <li>
          <span class="font-semibold text-gray-800 block">{{ posts.length }}</span>
          posts
        </li>
      </ul>
      <!-- insta features -->
      <ul
        class="flex items-center justify-around md:justify-center space-x-12 uppercase tracking-widest font-semibold text-xs text-gray-600 border-t"
      >
        <li class="md:border-t md:border-gray-700 md:-mt-px md:text-gray-700">
          <a class="inline-block p-3" href="#">
            <i class="fas fa-th-large text-xl md:text-xs"></i>
            <span class="hidden md:inline">post</span>
          </a>
        </li>
      </ul>
      <!-- flexbox grid -->
      <div class="flex flex-wrap -mx-px md:-mx-3">
        <!-- iterar sobre las publicaciones -->
        <div class="w-1/3 p-px md:px-3" *ngFor="let post of posts">
          <a href="javascript:void(0)" (click)="openModal(post)">
            <article class="post bg-gray-100 text-white relative pb-full md:mb-6">
              <img class="w-full h-full absolute left-0 top-0 object-cover" [src]="post.imageUrl" alt="image">
              <!-- overlay -->
              <div class="overlay bg-gray-800 bg-opacity-25 w-full h-full absolute left-0 top-0 hidden">
                <div class="flex justify-center items-center space-x-4 h-full">
                  <span class="p-2">
                    <i class="fas fa-heart">Descripcion:</i>
                    {{ post.description }}
                  </span>
                  <span class="p-2">
                    <i class="fas fa-comment">Corazon:</i>
                    {{ getHeartsLength(post.hearts) }}
                  </span>
                </div>
              </div>
            </article>
          </a>
        </div>
      </div>
    </div>
  </div>
</main>
